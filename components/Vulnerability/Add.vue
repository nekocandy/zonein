<script setup lang="ts">
const title = ref('')
const description = ref('')
const company = ref('')

async function addReport() {
  const realmApp = useRealmApp()
  const reportCollection = useCollection('reports')
  const { $toast } = useNuxtApp()

  if (!realmApp.currentUser) {
    $toast.error('You are not logged in!')
    return navigateTo('/login')
  }

  if (!title.value || !description.value || !company.value)
    $toast.error('Please fill all the fields!')

  const reportId = createId()

  await reportCollection.insertOne({
    reportId,
    title: title.value,
    description: description.value,
    company: company.value,
    createdAt: new Date(),
    userId: realmApp.currentUser.id,
    upvotes: [],
    downvotes: [],
    comments: [],
    status: 'ongoing',
    disclosure: false,
    disclosureTxn: null,
  })

  $toast.success('Report submitted!')
  title.value = ''
  description.value = ''
  company.value = ''
}
</script>

<template>
  <div>
    <div class="bg-[#222c56] rounded-xl w-full flex flex-col gap-4 p-6">
      <div class="text-center font-medium">
        Submit Report
      </div>
      <input v-model="title" class=" bg-[#01071f] px-4 py-2 rounded-xl" placeholder="// enter report title" type="text">
      <input v-model="company" class=" bg-[#01071f] px-4 py-2 rounded-xl" placeholder="// enter company name" type="text">
      <textarea v-model="description" class="bg-[#01071f] px-4 py-2 rounded-xl" placeholder="// enter report title" type="text" />

      <button class="w-full bg-[#01071f] px-4 py-2 rounded-xl" @click="addReport">
        Submit
      </button>
    </div>
  </div>
</template>

<style scoped>

</style>
